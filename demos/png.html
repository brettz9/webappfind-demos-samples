<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>View PNG</title>
    <style>img {width:100%;}</style>
</head>
<body>
<img />
<script type="module">
/* globals btoa */

let pathID,
    saveMessage = 'save',
    excludedMessages = [saveMessage],
    img = document.querySelector('img'),
    imageType = 'png';

document.title = 'WebAppFind ' + imageType.toUpperCase() + ' viewer';

window.addEventListener('message', function ({data, origin}) {
    let type, content;
    try {
        ({type, pathID, content} = data.webappfind); // May throw if data is not an object
        if (origin !== location.origin || // We are only interested in a message sent as though within this URL by our browser add-on
            excludedMessages.includes(type) // Avoid our post below (other messages might be possible in the future which may also need to be excluded if your subsequent code makes assumptions on the type of message this is)
        ) {
            return;
        }
    } catch (err) {
        return;
    }
    switch (type) {
    case 'view':
        // Populate the contents
        img.src = 'data:image/' + imageType + ';base64,' + btoa(content); // Converts binary string to base64
        // $('#save').disabled = false;
        break;
    /* case 'save-end':
        alert(`save complete for pathID ${pathID}!`);
        break; */
    default:
        throw 'Unexpected mode: ' + type;
    }
});

</script>
</body>
</html>
